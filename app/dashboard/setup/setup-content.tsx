"use client";

import { useState, useCallback } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import DashboardSidebar from "@/components/dashboard-sidebar";
import { authClient } from "@/lib/auth-client";
import { getStateNames, getCitiesByState, City } from "@/lib/india-data";
import type { User } from "better-auth/types";

interface SKUData {
  product_id: string;
  sku: string;
  product_name: string;
  product_description: string;
  product_dimensions: string;
  product_weight: string;
  product_price: string;
}

interface SetupContentProps {
  user: User;
}

export default function SetupContent({ user }: SetupContentProps) {
  const router = useRouter();
  const [pincodeInput, setPincodeInput] = useState("");
  const [pincodes, setPincodes] = useState<string[]>([]);
  const [selectedState, setSelectedState] = useState("");
  const [selectedCity, setSelectedCity] = useState<City | null>(null);
  const [isDragging, setIsDragging] = useState(false);
  const [skuData, setSkuData] = useState<SKUData[]>([]);
  const [isSetupComplete, setIsSetupComplete] = useState(false);
  const [error, setError] = useState("");

  const stateNames = getStateNames();
  const cities = selectedState ? getCitiesByState(selectedState) : [];

  const handleAddPincode = () => {
    const trimmed = pincodeInput.trim();
    if (trimmed && !pincodes.includes(trimmed)) {
      setPincodes([...pincodes, trimmed]);
      setPincodeInput("");
    }
  };

  const handleRemovePincode = (pincode: string) => {
    setPincodes(pincodes.filter((p: string) => p !== pincode));
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleAddPincode();
    }
  };

  const parseCSV = (text: string): SKUData[] => {
    const lines = text.trim().split("\n");
    if (lines.length < 2) return [];

    const headers = lines[0].split(",").map((h: string) => h.trim().toLowerCase());
    const data: SKUData[] = [];

    for (let i = 1; i < lines.length; i++) {
      const values = lines[i].split(",").map((v: string) => v.trim());
      const row: Record<string, string> = {};
      headers.forEach((header: string, index: number) => {
        row[header] = values[index] || "";
      });
      data.push({
        product_id: row.product_id || row["product id"] || "",
        sku: row.sku || "",
        product_name: row.product_name || row["product name"] || "",
        product_description: row.product_description || row["product description"] || "",
        product_dimensions: row.product_dimensions || row["product dimensions"] || "",
        product_weight: row.product_weight || row["product weight"] || "",
        product_price: row.product_price || row["product price"] || "",
      });
    }

    return data;
  };

  const handleFileUpload = (file: File) => {
    if (!file.name.endsWith(".csv")) {
      setError("Please upload a CSV file");
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const text = e.target?.result as string;
      const parsed = parseCSV(text);
      if (parsed.length > 0) {
        setSkuData(parsed);
        setError("");
      } else {
        setError("Invalid CSV format. Please check the sample file.");
      }
    };
    reader.readAsText(file);
  };

  const handleDrop = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
    const file = e.dataTransfer.files[0];
    if (file) {
      handleFileUpload(file);
    }
  }, []);

  const handleDragOver = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(true);
  }, []);

  const handleDragLeave = useCallback((e: React.DragEvent) => {
    e.preventDefault();
    setIsDragging(false);
  }, []);

  const handleFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      handleFileUpload(file);
    }
  };

  const handleStateChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    setSelectedState(e.target.value);
    setSelectedCity(null);
  };

  const handleCityChange = (e: React.ChangeEvent<HTMLSelectElement>) => {
    const cityName = e.target.value;
    const city = cities.find((c: City) => c.name === cityName) || null;
    setSelectedCity(city);
    if (city && !pincodes.includes(city.pincode)) {
      setPincodes([...pincodes, city.pincode]);
    }
  };

  const handleSetup = () => {
    if (pincodes.length === 0 && !selectedCity) {
      setError("Please add at least one PIN code");
      return;
    }
    setIsSetupComplete(true);
  };

  const handleSignOut = async () => {
    await authClient.signOut();
    router.push("/signin");
    router.refresh();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex">
      <DashboardSidebar onSignOut={handleSignOut} />

      <main className="flex-1 overflow-auto">
        <div className="container mx-auto px-6 py-8">
          <div className="mb-8">
            <h2 className="text-3xl font-bold tracking-tight">Setup</h2>
            <p className="text-muted-foreground mt-1">
              Configure your PIN codes and upload SKU data to get started.
            </p>
          </div>

          {!isSetupComplete ? (
            <div className="grid gap-6 lg:grid-cols-2">
              <Card className="border-0 shadow-lg">
                <CardHeader>
                  <CardTitle>Location Configuration</CardTitle>
                  <CardDescription>
                    Select your state and city or add PIN codes manually
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-6">
                  <div className="space-y-2">
                    <Label htmlFor="state">Select State</Label>
                    <select
                      id="state"
                      value={selectedState}
                      onChange={handleStateChange}
                      className="w-full h-11 px-3 rounded-md border border-input bg-background text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500"
                    >
                      <option value="">Choose a state</option>
                      {stateNames.map((state: string) => (
                        <option key={state} value={state}>
                          {state}
                        </option>
                      ))}
                    </select>
                  </div>

                  {selectedState && (
                    <div className="space-y-2">
                      <Label htmlFor="city">Select City</Label>
                      <select
                        id="city"
                        value={selectedCity?.name || ""}
                        onChange={handleCityChange}
                        className="w-full h-11 px-3 rounded-md border border-input bg-background text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-cyan-500"
                      >
                        <option value="">Choose a city</option>
                        {cities.map((city: City) => (
                          <option key={city.name} value={city.name}>
                            {city.name} ({city.pincode})
                          </option>
                        ))}
                      </select>
                    </div>
                  )}

                  <div className="relative">
                    <div className="absolute inset-0 flex items-center">
                      <span className="w-full border-t" />
                    </div>
                    <div className="relative flex justify-center text-xs uppercase">
                      <span className="bg-white px-2 text-muted-foreground">
                        Or add manually
                      </span>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="pincode">Add PIN Code</Label>
                    <div className="flex gap-2">
                      <Input
                        id="pincode"
                        placeholder="Enter 6-digit PIN code"
                        value={pincodeInput}
                        onChange={(e) => setPincodeInput(e.target.value)}
                        onKeyDown={handleKeyDown}
                        maxLength={6}
                        className="h-11"
                      />
                      <Button
                        type="button"
                        onClick={handleAddPincode}
                        className="h-11 bg-cyan-600 hover:bg-cyan-700"
                      >
                        Add
                      </Button>
                    </div>
                  </div>

                  {pincodes.length > 0 && (
                    <div className="space-y-2">
                      <Label>Added PIN Codes</Label>
                      <div className="flex flex-wrap gap-2">
                        {pincodes.map((pincode: string) => (
                          <span
                            key={pincode}
                            className="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-cyan-50 text-cyan-700 text-sm"
                          >
                            {pincode}
                            <button
                              type="button"
                              onClick={() => handleRemovePincode(pincode)}
                              className="ml-1 hover:text-cyan-900"
                            >
                              <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                              </svg>
                            </button>
                          </span>
                        ))}
                      </div>
                    </div>
                  )}
                </CardContent>
              </Card>

              <Card className="border-0 shadow-lg">
                <CardHeader>
                  <CardTitle>Upload SKU Data</CardTitle>
                  <CardDescription>
                    Upload a CSV file with your product inventory
                  </CardDescription>
                </CardHeader>
                <CardContent className="space-y-4">
                  <Link
                    href="/sample-sku-upload.csv"
                    download
                    className="inline-flex items-center text-sm text-cyan-600 hover:text-cyan-700"
                  >
                    <svg className="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Download Sample CSV
                  </Link>

                  <div
                    onDrop={handleDrop}
                    onDragOver={handleDragOver}
                    onDragLeave={handleDragLeave}
                    className={`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${
                      isDragging
                        ? "border-cyan-500 bg-cyan-50"
                        : "border-gray-300 hover:border-cyan-400"
                    }`}
                  >
                    <input
                      type="file"
                      accept=".csv"
                      onChange={handleFileInput}
                      className="hidden"
                      id="csv-upload"
                    />
                    <label htmlFor="csv-upload" className="cursor-pointer">
                      <svg
                        className="mx-auto h-12 w-12 text-gray-400"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          strokeLinecap="round"
                          strokeLinejoin="round"
                          strokeWidth={2}
                          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                        />
                      </svg>
                      <p className="mt-2 text-sm text-gray-600">
                        Drag and drop your CSV file here, or{" "}
                        <span className="text-cyan-600 font-medium">browse</span>
                      </p>
                      <p className="mt-1 text-xs text-gray-400">
                        Supported format: .csv
                      </p>
                    </label>
                  </div>

                  {skuData.length > 0 && (
                    <div className="p-3 bg-green-50 rounded-lg">
                      <p className="text-sm text-green-700">
                        âœ“ Successfully loaded {skuData.length} SKUs
                      </p>
                    </div>
                  )}

                  {error && (
                    <div className="p-3 bg-red-50 rounded-lg">
                      <p className="text-sm text-red-700">{error}</p>
                    </div>
                  )}

                  <div className="relative">
                    <div className="absolute inset-0 flex items-center">
                      <span className="w-full border-t" />
                    </div>
                    <div className="relative flex justify-center text-xs uppercase">
                      <span className="bg-white px-2 text-muted-foreground">
                        Or connect with
                      </span>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    <Button
                      type="button"
                      variant="outline"
                      className="h-11 justify-start gap-2 border-gray-200 hover:bg-gray-50"
                    >
                      <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.337 3.415c-.152-.114-.344-.1-.488.036-.145.135-.198.34-.135.523.065.185.227.314.417.33h.002c.19-.016.35-.145.415-.33.063-.183.01-.388-.135-.523-.144-.136-.336-.15-.488-.036zM3.91 4.485c-.098.073-.16.188-.162.305-.002.118.058.233.158.303.098.07.224.092.335.058.112-.033.204-.11.244-.206.04-.095.04-.205.002-.3-.04-.096-.127-.175-.23-.21-.102-.036-.213-.02-.303.042l-.044-.044zm-.002.002c-.09-.06-.2-.075-.296-.04-.095.034-.173.1-.21.178-.038.078-.043.17-.015.248.028.078.09.144.168.178.078.033.164.03.238-.008.073-.039.132-.1.162-.17l.053.062zm14.455 1.24c-.112.006-.216.057-.282.137-.066.08-.095.184-.078.285.017.1.07.19.145.248.075.057.17.09.267.09.097 0 .19-.033.266-.09.075-.058.128-.148.145-.248.017-.02.02-.042.024-.063l-.037-.005c-.037-.006-.073-.02-.106-.04-.033-.02-.06-.046-.082-.076-.022-.03-.037-.063-.045-.097-.008-.034-.008-.069 0-.103.008-.034.023-.066.044-.095.021-.029.048-.054.078-.075.03-.02.063-.035.098-.043l-.005-.002c-.035-.008-.068-.007-.1.002-.033.01-.063.028-.088.053-.025.025-.044.055-.056.088-.012.033-.015.067-.009.1.006.033.02.065.042.093.022.028.05.05.08.067l-.063-.016c-.03.02-.055.045-.074.073-.02.028-.034.06-.042.092-.008.033-.006.067.006.1.012.033.033.063.06.087.026.025.058.042.092.05l.092-.007c-.03.016-.056.037-.077.063-.02.026-.036.056-.046.089-.01.033-.012.067-.005.1.007.034.023.065.048.093.025.028.056.05.09.063l.09-.057c-.02.02-.036.044-.048.07-.012.026-.02.053-.024.08-.004.028-.002.056.006.083.008.028.024.054.046.077.022.023.05.04.08.052.03.011.062.012.093.002.03-.01.058-.028.082-.052l-.025.033c.024-.022.05-.038.078-.048.027-.01.056-.014.084-.012.028.002.055.012.08.028.025.017.046.04.06.067l-.085-.033c.024.014.044.033.06.055.016.022.027.047.034.073.007.026.008.053.003.08-.005.026-.017.051-.036.073-.018.022-.042.04-.07.052l.085.02c-.026.012-.053.017-.08.016-.027-.002-.053-.01-.076-.024-.024-.014-.044-.033-.06-.056-.015-.023-.026-.048-.033-.075-.006-.026-.006-.053.002-.079l-.042.02c.015-.02.034-.037.056-.05.022-.014.046-.024.072-.03.026-.006.053-.007.08-.004.026.004.05.013.072.027.022.014.04.033.054.055l.085-.042c-.012.022-.02.045-.025.069-.004.024-.004.048 0 .072.005.024.016.047.034.067.017.02.04.036.065.047l-.097-.028c.023.015.043.035.058.06.015.024.025.05.03.077.004.027.003.054-.004.08-.007.027-.02.052-.04.074-.019.022-.043.04-.072.052l.097-.003c-.028.01-.056.014-.084.012-.028-.002-.055-.01-.08-.024-.024-.014-.046-.033-.063-.056-.017-.024-.03-.05-.038-.077l-.038.037c.012-.022.03-.04.052-.055.022-.014.046-.024.073-.03.026-.006.054-.006.08-.001.027.005.05.015.072.03.022.015.04.035.054.058l.05-.05c-.01.02-.015.042-.016.064-.001.022.003.044.012.065.01.021.025.04.044.056.02.016.043.027.068.034l-.062-.026c.022.014.04.033.055.057.014.024.024.05.028.077.004.027.002.054-.006.08-.008.027-.022.052-.043.074l.073-.018c-.025.013-.05.02-.076.023-.026.002-.052-.002-.077-.012-.024-.01-.046-.025-.064-.045-.018-.02-.032-.043-.042-.068l-.026.033c.012-.022.03-.04.054-.054.023-.014.048-.024.075-.03.027-.006.055-.006.082-.001l-.002.003c.027.004.05.014.07.03.02.016.036.037.048.062.012.025.018.052.018.079 0 .027-.006.053-.02.078l.046-.046c-.012.022-.02.046-.024.07-.004.025-.003.05.004.074.007.025.02.048.04.068l-.085-.02c.02.016.037.036.05.06.013.024.022.05.026.077.004.027.002.054-.006.08l.045-.04c-.01.022-.015.045-.016.068-.001.024.002.047.01.07.008.023.022.044.042.063.02.018.044.032.07.041l-.068-.032c.025.015.045.035.06.059.015.025.025.052.028.08.004.027.001.055-.008.08l.055-.048c-.01.024-.013.048-.01.072.003.024.012.047.027.068.015.02.035.038.06.052l-.08-.04c.022.017.04.038.053.063.013.025.022.052.025.08.003.027-.001.055-.012.08l.065-.057c-.01.025-.012.05-.007.075.005.025.016.048.034.068l-.095-.05c.02.018.036.04.048.064.012.025.02.052.022.08.002.027-.003.055-.016.08l.08-.07c-.01.025-.01.05-.002.074.008.025.022.047.043.066l-.11-.06c.02.02.036.043.046.067.01.025.016.052.016.078 0 .027-.006.053-.02.078l.097-.085c-.01.024-.01.048-.002.072.008.024.02.046.038.065l-.12-.07c.017.02.03.043.04.067.01.024.015.05.015.075 0 .026-.005.052-.018.076l.11-.095c-.01.023-.008.046 0 .07.01.023.022.044.038.063l-.132-.08c.016.022.028.045.036.07.008.024.012.05.012.075 0 .026-.004.051-.015.075l.125-.108c-.01.023-.007.046.002.07.009.023.02.044.034.063l-.145-.088c.015.022.026.046.033.071.007.025.01.05.009.076-.001.025-.008.05-.02.074l.138-.12c-.01.023-.006.046.003.07.01.023.02.044.032.063l-.158-.095c.014.023.024.047.03.072.006.025.008.05.006.076-.002.025-.01.05-.024.073l.152-.132c-.01.023-.005.046.004.07.01.023.018.044.028.063l-.17-.1c.013.024.022.048.027.073.005.025.006.05.003.076-.003.025-.012.049-.027.072l.165-.144c-.01.023-.004.046.005.07.01.023.016.044.025.064l-.18-.105c.012.024.02.048.024.073.004.025.004.05 0 .076-.004.025-.014.049-.03.072l.178-.156c-.01.023-.003.046.006.07.01.023.015.044.022.064l-.19-.11c.012.024.018.048.022.073.003.025.002.05-.003.075-.006.025-.018.049-.036.071l.19-.168c-.01.023-.002.046.007.07.01.023.013.044.02.064l-.2-.115c.01.024.016.048.018.073.002.025 0 .05-.006.075-.006.025-.02.048-.04.07l.208-.18c-.01.023 0 .046.008.07.008.023.012.044.017.064l-.216-.12c.01.024.013.048.014.073.001.025-.002.05-.01.074-.008.025-.024.047-.046.068l.224-.19c-.01.022.002.046.01.07.008.023.01.044.015.064l-.23-.125c.008.024.01.048.009.073-.001.025-.006.05-.018.073-.012.024-.03.045-.054.066l.24-.2c-.01.022.003.046.012.07.008.023.008.044.013.064l-.248-.13c.007.024.008.048.006.072-.002.025-.01.049-.024.072-.015.022-.036.042-.062.062l.256-.21c-.01.022.004.046.014.07.007.023.007.044.01.064l-.264-.135c.006.024.006.048.004.072-.003.024-.012.048-.028.071-.016.022-.04.042-.068.06l.272-.22c-.01.022.005.046.016.07.007.023.005.044.008.064l-.278-.14c.005.024.004.048 0 .073-.004.024-.014.048-.032.07-.018.022-.044.04-.075.058l.284-.23c-.01.022.006.046.018.07.006.023.004.044.006.064l-.29-.145c.004.024.002.048-.004.072-.006.024-.018.047-.036.069-.019.022-.048.04-.08.056l.296-.24c-.01.022.007.046.02.07.006.023.003.044.004.064l-.302-.15c.003.024 0 .048-.007.072-.008.024-.022.046-.042.068-.02.02-.052.038-.088.054l.306-.248c-.01.022.008.046.022.07.005.023.002.044.002.064l-.312-.155c.002.024-.002.048-.012.072-.01.023-.026.045-.048.066-.022.02-.055.036-.095.05l.315-.255c-.01.022.01.046.025.07.004.023.001.044 0 .064l-.318-.16c.001.024-.004.048-.016.072-.012.023-.03.044-.054.064-.024.02-.058.035-.1.046l.324-.263c-.01.022.01.046.027.07.003.023 0 .044-.003.064l-.33-.165c0 .024-.006.048-.02.071-.014.023-.035.043-.06.062-.025.018-.062.033-.108.042l.332-.27c-.01.022.012.046.03.07.002.023-.001.044-.006.064l-.34-.17c-.001.024-.008.048-.024.071-.016.022-.04.042-.068.06-.028.018-.065.03-.112.04l.344-.276c-.01.022.013.046.033.07.002.023-.002.044-.008.064l-.348-.176c-.002.024-.01.048-.028.07-.018.022-.045.04-.075.058-.03.016-.068.028-.116.036l.352-.283c-.01.022.014.046.036.07.001.023-.003.044-.01.064l-.356-.18c-.003.024-.012.047-.032.07-.02.02-.05.038-.084.054-.034.015-.07.025-.116.032l.36-.29c-.01.022.016.046.04.07 0 .023-.004.044-.013.064l-.364-.186c-.004.023-.014.047-.036.068-.022.02-.055.036-.092.052-.036.014-.073.023-.12.03l.368-.296c-.01.022.017.046.043.07-.001.023-.006.044-.016.064l-.372-.192c-.005.023-.016.046-.04.068-.024.02-.06.034-.1.05-.038.013-.077.02-.124.028l.376-.3c-.01.022.018.046.046.07-.002.023-.008.044-.02.063l-.38-.197c-.006.023-.018.046-.044.067-.026.02-.065.033-.108.047-.042.012-.08.018-.127.024l.38-.306c-.01.022.02.046.05.07-.002.022-.01.044-.023.063l-.385-.203c-.007.023-.02.045-.048.066-.028.02-.07.032-.115.044-.045.012-.084.016-.132.02l.385-.31c-.01.022.02.046.053.07-.003.022-.012.043-.027.063l-.39-.208c-.008.023-.022.045-.052.065-.03.02-.075.03-.122.042-.048.01-.087.013-.136.016l.39-.316c-.01.022.022.046.057.07-.003.022-.014.043-.03.062l-.396-.214c-.009.023-.024.044-.056.064-.032.02-.08.03-.128.04-.05.008-.09.01-.144.013l.396-.32c-.01.022.024.046.06.07-.004.022-.016.042-.033.062l-.402-.22c-.01.023-.026.044-.06.063-.035.018-.085.028-.136.036-.05.006-.094.006-.144.006l.4-.325c-.01.022.025.046.064.07-.004.022-.018.042-.04.06l-.408-.226c-.011.022-.028.043-.065.062-.037.018-.09.026-.145.032-.055.005-.098.003-.15.003l.404-.33c-.01.022.027.046.068.07-.005.022-.02.04-.045.06l-.414-.232c-.012.022-.03.042-.07.06-.04.018-.095.025-.155.028-.06.003-.104 0-.16 0l.408-.334c-.01.022.028.046.072.07-.006.02-.022.04-.05.058l-.42-.238c-.013.022-.032.04-.075.058-.043.016-.1.022-.166.024-.066.002-.11-.002-.17-.002l.412-.34c-.01.022.03.046.076.07-.007.02-.025.038-.058.056l-.426-.244c-.014.02-.034.038-.08.056-.046.016-.107.02-.178.02-.07 0-.116-.005-.178-.008l.415-.344c-.01.022.032.046.08.07-.008.02-.027.037-.065.054l-.432-.25c-.015.02-.036.036-.085.054-.05.015-.114.017-.186.016-.072-.002-.12-.01-.184-.015l.418-.348c-.01.022.034.046.085.07-.009.018-.03.036-.072.052l-.438-.256c-.016.02-.038.035-.09.05-.053.015-.12.015-.194.013-.074-.003-.127-.012-.195-.02l.42-.352c-.01.022.036.046.09.07-.01.018-.032.035-.078.05l-.444-.262c-.017.018-.04.034-.095.048-.055.014-.128.012-.204.008-.076-.004-.134-.015-.207-.026l.423-.356c-.01.022.038.046.095.07-.011.018-.035.033-.085.048-.05.013-.136.01-.218.004-.082-.006-.142-.02-.22-.034l.426-.36c-.01.022.04.046.1.07-.012.016-.038.032-.092.046-.054.012-.145.007-.23-.002-.085-.01-.15-.027-.235-.045l.428-.364c-.01.022.042.046.105.07-.013.016-.04.03-.098.044-.058.012-.153.005-.243-.008-.09-.013-.158-.033-.248-.055l.43-.368c-.01.022.044.046.11.07-.014.014-.043.028-.105.04-.062.012-.162.002-.257-.016-.095-.018-.166-.04-.262-.065l.433-.372c-.01.022.046.046.116.07-.015.014-.046.027-.112.038-.066.01-.17-.002-.272-.025-.102-.022-.175-.048-.277-.077l.435-.376c-.01.022.048.046.12.07-.016.012-.048.025-.118.036-.07.008-.18-.006-.288-.034-.108-.028-.183-.058-.292-.093l.438-.38c-.01.022.05.046.126.07-.017.012-.05.022-.124.033-.074.008-.188-.01-.302-.043-.114-.034-.19-.067-.305-.107l.44-.384c-.01.022.052.046.132.07-.018.01-.053.02-.13.03-.078.007-.196-.015-.315-.052-.12-.04-.198-.078-.318-.125l.443-.388c-.01.022.054.046.138.07-.02.01-.056.018-.137.027-.08.006-.204-.02-.33-.063-.124-.043-.207-.088-.336-.142l.445-.392c-.01.022.056.046.144.07-.02.008-.058.016-.143.024-.085.004-.212-.025-.345-.075-.133-.05-.214-.1-.353-.162l.448-.396c-.01.022.058.046.15.07-.022.008-.06.014-.15.02-.09.003-.22-.03-.36-.086-.14-.056-.222-.112-.366-.182l.45-.4c-.01.022.06.046.156.07-.023.006-.063.012-.158.018-.094 0-.228-.036-.376-.098-.147-.063-.23-.124-.383-.202l.453-.404c-.01.022.062.046.162.07-.024.004-.066.01-.165.014-.1-.003-.235-.04-.39-.108-.156-.07-.24-.135-.4-.222l.455-.408c-.01.022.064.046.168.07-.025.004-.068.008-.172.01-.104-.006-.243-.048-.405-.118-.163-.076-.25-.145-.418-.242l.458-.412c-.01.022.066.046.175.07-.026.002-.07.004-.18.004-.108-.01-.25-.054-.42-.128-.17-.08-.26-.157-.436-.262l.46-.416c-.01.022.068.046.182.07-.027 0-.073.002-.188-.003-.112-.013-.258-.06-.435-.138-.178-.085-.27-.168-.456-.282l.463-.42c-.01.022.07.046.188.07-.028 0-.075-.002-.195-.01-.12-.018-.265-.068-.45-.148-.184-.09-.28-.18-.472-.302l.465-.424c-.01.022.072.046.195.07-.03-.002-.078-.006-.203-.015-.125-.023-.272-.075-.465-.158-.193-.095-.29-.193-.488-.322l.468-.428c-.01.022.074.046.202.07-.03-.004-.08-.01-.21-.022-.13-.028-.28-.083-.48-.17-.2-.1-.3-.206-.504-.342l.47-.432c-.01.022.076.046.21.07-.032-.006-.083-.015-.22-.03-.135-.035-.286-.09-.495-.18-.21-.11-.31-.218-.52-.362l.473-.436c-.01.022.078.046.217.07-.033-.008-.086-.022-.227-.04-.14-.042-.293-.098-.51-.19-.22-.115-.32-.232-.537-.382l.475-.44c-.01.022.08.046.224.07-.034-.01-.088-.028-.235-.05-.146-.05-.3-.107-.525-.2-.23-.12-.33-.247-.555-.402l.478-.444c-.01.022.082.046.231.07-.035-.012-.09-.035-.242-.06-.152-.057-.307-.114-.54-.21-.235-.126-.34-.262-.572-.422l.48-.448c-.01.022.084.046.239.07-.036-.014-.093-.042-.25-.072-.158-.065-.313-.123-.555-.222-.24-.132-.35-.278-.588-.44l.483-.452c-.01.022.086.046.246.07-.037-.016-.095-.05-.257-.084-.163-.072-.32-.132-.57-.234-.25-.138-.36-.293-.604-.46l.485-.456c-.01.022.088.046.254.07-.038-.018-.098-.058-.264-.096-.17-.08-.326-.142-.585-.246-.26-.145-.37-.31-.62-.48l.488-.46c-.01.022.09.046.262.07-.04-.02-.1-.065-.272-.108-.176-.088-.333-.15-.6-.258-.27-.152-.38-.326-.636-.5l.49-.464c-.01.022.092.046.27.07-.04-.022-.103-.072-.28-.12-.182-.096-.34-.16-.614-.27-.275-.16-.39-.343-.652-.52l.493-.468c-.01.022.094.046.278.07-.042-.024-.105-.08-.288-.132-.188-.103-.346-.168-.628-.282-.282-.168-.402-.36-.668-.54l.495-.472c-.01.022.096.046.286.07-.043-.026-.108-.087-.295-.144-.194-.112-.352-.177-.64-.294-.29-.176-.412-.378-.685-.56l.498-.476c-.01.022.098.046.294.07-.044-.028-.11-.095-.302-.156-.2-.12-.358-.186-.653-.306-.295-.184-.423-.395-.7-.58l.5-.48c-.01.022.1.046.302.07-.046-.03-.113-.102-.31-.168-.207-.128-.364-.194-.665-.318-.3-.192-.433-.413-.716-.6l.503-.484c-.01.022.102.046.31.07-.047-.032-.116-.11-.318-.18-.213-.136-.37-.203-.678-.33-.306-.2-.443-.43-.732-.62l.505-.488c-.01.022.104.046.318.07-.048-.034-.118-.117-.325-.192-.22-.144-.376-.212-.69-.342-.315-.208-.454-.448-.748-.64l.508-.492c-.01.022.106.046.326.07-.05-.036-.12-.124-.332-.204-.226-.152-.382-.22-.7-.354-.32-.216-.464-.466-.765-.66l.51-.496c-.01.022.108.046.334.07-.05-.038-.123-.13-.34-.216-.233-.16-.388-.23-.712-.366-.325-.224-.474-.484-.78-.68l.513-.5c-.01.022.11.046.342.07-.052-.04-.126-.137-.348-.228-.24-.168-.395-.238-.724-.378-.33-.232-.485-.502-.795-.7l.515-.504c-.01.022.112.046.35.07-.053-.042-.128-.144-.355-.24-.246-.176-.4-.247-.735-.39-.335-.24-.495-.52-.81-.72l.518-.508c-.01.022.114.046.358.07-.054-.044-.13-.15-.362-.252-.253-.184-.408-.255-.746-.403-.34-.25-.505-.538-.825-.74l.52-.512c-.01.022.116.046.366.07-.055-.046-.133-.157-.37-.264-.26-.192-.415-.264-.757-.416-.345-.258-.515-.556-.84-.76l.523-.516c-.01.022.118.046.374.07-.056-.048-.135-.163-.377-.276-.266-.2-.422-.273-.767-.43-.35-.266-.525-.574-.855-.78l.525-.52c-.01.022.12.046.382.07-.057-.05-.138-.17-.384-.288-.273-.208-.43-.282-.778-.444-.356-.274-.535-.593-.87-.8l.528-.524c-.01.022.122.046.39.07-.058-.052-.14-.176-.39-.3-.28-.216-.436-.292-.788-.458-.365-.282-.544-.61-.885-.82l.53-.528c-.01.022.124.046.398.07-.06-.054-.143-.183-.398-.312-.286-.224-.442-.3-.798-.472-.375-.29-.554-.628-.9-.84l.533-.532c-.01.022.126.046.406.07-.06-.056-.145-.19-.404-.324-.292-.232-.448-.31-.808-.486-.385-.3-.564-.646-.915-.86l.535-.536c-.01.022.128.046.414.07-.062-.058-.148-.196-.41-.336-.298-.24-.454-.32-.817-.5-.395-.308-.573-.664-.93-.88l.538-.54c-.01.022.13.046.422.07-.063-.06-.15-.203-.418-.348-.305-.248-.46-.33-.827-.514-.405-.316-.582-.682-.944-.9l.54-.544c-.01.022.132.046.43.07-.064-.062-.152-.21-.424-.36-.31-.256-.466-.34-.835-.528-.415-.324-.59-.7-.957-.92l.543-.548c-.01.022.134.046.44.07-.065-.064-.155-.216-.43-.372-.318-.264-.472-.35-.844-.542-.425-.334-.6-.718-.97-.94l.545-.552c-.01.022.136.046.448.07-.066-.066-.158-.223-.436-.384-.325-.272-.478-.36-.852-.556-.434-.342-.608-.735-.983-.96l.548-.556c-.01.022.138.046.456.07-.067-.068-.16-.23-.442-.396-.332-.28-.484-.37-.86-.57-.444-.35-.616-.752-.995-.98l.55-.56c-.01.022.14.046.464.07-.068-.07-.162-.236-.448-.408-.34-.288-.49-.38-.87-.584-.453-.358-.624-.77-1.008-1l.553-.564c-.01.022.142.046.472.07-.07-.072-.165-.242-.454-.42-.346-.296-.495-.39-.878-.598-.462-.366-.632-.787-1.02-1.02l.555-.568c-.01.022.144.046.48.07-.07-.074-.167-.25-.46-.432-.352-.304-.5-.402-.886-.612-.47-.374-.64-.804-1.032-1.04l.558-.572c-.01.022.146.046.488.07-.072-.076-.17-.256-.466-.444-.36-.312-.506-.412-.894-.626-.48-.382-.65-.822-1.045-1.06l.56-.576c-.01.022.148.046.496.07-.073-.078-.172-.262-.472-.456-.366-.32-.512-.422-.9-.64-.488-.39-.656-.84-1.057-1.08l.563-.58c-.01.022.15.046.504.07-.074-.08-.175-.268-.478-.468-.373-.33-.517-.432-.907-.654-.495-.398-.663-.857-1.068-1.1l.565-.584c-.01.022.152.046.512.07-.075-.082-.177-.275-.484-.48-.38-.338-.523-.443-.914-.668-.503-.406-.67-.874-1.08-1.12l.568-.588c-.01.022.154.046.52.07-.076-.084-.178-.28-.49-.492-.386-.346-.528-.454-.92-.682-.51-.414-.677-.892-1.092-1.14l.57-.592c-.01.022.156.046.528.07-.077-.086-.18-.286-.496-.504-.392-.354-.534-.464-.928-.696-.518-.422-.684-.907-1.105-1.16l.573-.596c-.01.022.158.046.536.07-.078-.088-.182-.292-.502-.516-.398-.362-.54-.475-.935-.71-.525-.43-.69-.923-1.116-1.18l.575-.6c-.01.022.16.046.544.07-.08-.09-.184-.298-.508-.528-.404-.37-.545-.485-.94-.724-.532-.44-.696-.94-1.127-1.2l.578-.604c-.01.022.162.046.552.07-.08-.092-.185-.304-.514-.54-.41-.378-.55-.495-.947-.74-.54-.448-.702-.956-1.14-1.22l.58-.608c-.01.022.164.046.56.07-.082-.094-.187-.31-.52-.552-.416-.386-.555-.505-.953-.754-.547-.456-.708-.973-1.15-1.24l.583-.612c-.01.022.166.046.568.07-.083-.096-.19-.316-.526-.564-.422-.395-.56-.516-.96-.77-.555-.464-.714-.99-1.162-1.26l.585-.616c-.01.022.168.046.576.07-.084-.098-.192-.322-.532-.576-.43-.404-.565-.527-.967-.786-.562-.472-.72-1.006-1.174-1.28l.588-.62c-.01.022.17.046.584.07-.085-.1-.194-.328-.538-.588-.435-.413-.57-.537-.973-.8-.57-.48-.726-1.022-1.185-1.3l.59-.624c-.01.022.172.046.592.07-.086-.102-.196-.334-.544-.6-.442-.422-.575-.548-.98-.816-.578-.49-.732-1.04-1.196-1.32l.593-.628c-.01.022.174.046.6.07-.087-.104-.198-.34-.55-.612-.448-.43-.58-.558-.986-.83-.585-.496-.738-1.055-1.206-1.34l.595-.632c-.01.022.176.046.608.07-.088-.106-.2-.345-.555-.624-.455-.44-.585-.57-.992-.846-.593-.504-.744-1.072-1.218-1.36l.598-.636c-.09.012-.18.025-.27.037-.09.013-.182.025-.273.038-.092.012-.183.025-.274.037l-.274-.037c-.09-.013-.18-.025-.27-.038-.09-.012-.182-.025-.273-.037l-.273.037c-.09.012-.18.025-.27.037-.09.013-.181.025-.272.038l-.272-.038c-.09-.013-.18-.025-.27-.037-.09-.012-.181-.025-.272-.037l-.272.037c-.09.012-.18.025-.27.037-.09.012-.181.025-.272.037l-.272-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.181-.025-.272-.037l-.272.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.271.038l-.271-.038c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.271-.037l-.271.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.038l-.27-.038c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.013-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.013-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.025-.27.037-.09.012-.18.025-.27.037l-.27-.037c-.09-.012-.18-.025-.27-.037-.09-.013-.18-.025-.27-.037l-.27.037c-.09.012-.18.05-.27.063z"/>
                      </svg>
                      Connect Shopify
                    </Button>
                    <Button
                      type="button"
                      variant="outline"
                      className="h-11 justify-start gap-2 border-gray-200 hover:bg-gray-50"
                    >
                      <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.353 6.294c-.17-.09-.283-.19-.283-.32 0-.14.145-.24.435-.3.63-.13 1.135-.2 1.565-.23.42-.03.77-.04 1.05-.04.91 0 1.62.16 2.12.47.5.31.75.74.75 1.28 0 .38-.12.68-.35.9-.24.22-.57.38-.99.48l-.36.08c-.3.07-.58.15-.84.26-.26.11-.48.26-.66.45-.18.2-.3.45-.36.75-.06.3-.09.66-.09 1.08 0 .61.12 1.13.36 1.56.24.43.58.76 1.02 1 .44.24.96.36 1.56.36.45 0 .86-.07 1.23-.21.37-.14.68-.33.93-.57.25-.24.44-.52.57-.84.13-.32.2-.66.2-1.02 0-.45-.1-.82-.3-1.11-.2-.29-.48-.5-.84-.63.27-.15.47-.36.6-.63.13-.27.2-.58.2-.93 0-.36-.07-.68-.21-.96-.14-.28-.34-.5-.6-.66-.26-.16-.56-.27-.9-.33-.34-.06-.7-.09-1.08-.09-.57 0-1.08.07-1.53.21-.45.14-.82.33-1.11.57-.29.24-.51.53-.66.87-.15.34-.23.72-.23 1.14 0 .3.05.56.15.78.1.22.24.4.42.54.18.14.39.24.63.3l.36.06c.28.06.52.14.72.24.2.1.36.24.48.42.12.18.18.4.18.66 0 .3-.08.54-.24.72-.16.18-.38.27-.66.27-.25 0-.47-.07-.66-.21-.19-.14-.34-.32-.45-.54-.11-.22-.17-.46-.17-.72 0-.28.07-.52.21-.72.14-.2.32-.36.54-.48l.36-.12c.3-.1.56-.2.78-.3.22-.1.4-.24.54-.42.14-.18.24-.4.3-.66.06-.26.09-.56.09-.9 0-.58-.1-1.08-.3-1.5-.2-.42-.48-.74-.84-.96-.36-.22-.78-.33-1.26-.33-.42 0-.8.07-1.14.21-.34.14-.62.33-.84.57-.22.24-.39.52-.51.84-.12.32-.18.66-.18 1.02z"/>
                      </svg>
                      Connect WooCommerce
                    </Button>
                  </div>
                </CardContent>
              </Card>

              <div className="lg:col-span-2">
                <Button
                  onClick={handleSetup}
                  className="w-full h-12 text-base bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700"
                >
                  Setup
                </Button>
              </div>
            </div>
          ) : (
            <div className="space-y-6">
              <Card className="border-0 shadow-lg">
                <CardHeader>
                  <CardTitle>Configured PIN Codes</CardTitle>
                  <CardDescription>
                    {pincodes.length} PIN code(s) configured for demand forecasting
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="flex flex-wrap gap-2">
                    {pincodes.map((pincode: string) => (
                      <span
                        key={pincode}
                        className="inline-flex items-center px-4 py-2 rounded-full bg-cyan-50 text-cyan-700 font-medium"
                      >
                        {pincode}
                      </span>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {skuData.length > 0 && (
                <Card className="border-0 shadow-lg">
                  <CardHeader>
                    <CardTitle>Uploaded SKU Data</CardTitle>
                    <CardDescription>
                      {skuData.length} product(s) loaded from CSV
                    </CardDescription>
                  </CardHeader>
                  <CardContent>
                    <div className="overflow-x-auto">
                      <table className="w-full text-sm">
                        <thead>
                          <tr className="border-b">
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Product ID</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">SKU</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Product Name</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Description</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Dimensions</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Weight</th>
                            <th className="text-left py-3 px-2 font-medium text-gray-600">Price</th>
                          </tr>
                        </thead>
                        <tbody>
                          {skuData.map((sku: SKUData, index: number) => (
                            <tr key={index} className="border-b last:border-0">
                              <td className="py-3 px-2">{sku.product_id}</td>
                              <td className="py-3 px-2">{sku.sku}</td>
                              <td className="py-3 px-2 font-medium">{sku.product_name}</td>
                              <td className="py-3 px-2 text-gray-500 max-w-xs truncate">
                                {sku.product_description}
                              </td>
                              <td className="py-3 px-2">{sku.product_dimensions}</td>
                              <td className="py-3 px-2">{sku.product_weight}</td>
                              <td className="py-3 px-2 font-medium text-cyan-600">
                                {sku.product_price}
                              </td>
                            </tr>
                          ))}
                        </tbody>
                      </table>
                    </div>
                  </CardContent>
                </Card>
              )}

              <Button
                onClick={() => setIsSetupComplete(false)}
                variant="outline"
                className="border-cyan-200 text-cyan-700 hover:bg-cyan-50"
              >
                Edit Configuration
              </Button>
            </div>
          )}
        </div>
      </main>
    </div>
  );
}
